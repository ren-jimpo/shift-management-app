# シフト管理システム

3店舗（京橋・天満・本町）のシフト作成および管理を効率化するWebアプリケーション

## 技術スタック

### フロントエンド
- **Next.js** 15.3.4 - React フレームワーク（App Router使用）
- **React** 19.0.0 - UIライブラリ
- **TypeScript** 5.x - 型安全な開発
- **Tailwind CSS** 4.x - ユーティリティファーストCSS
- **clsx & tailwind-merge** - 条件付きクラス名の管理

### バックエンド・外部サービス
- **Resend** - メール送信サービス
- **Next.js API Routes** - サーバーサイドAPI

### 開発環境
- **ESLint** - コード品質管理
- **PostCSS** - CSS後処理

### デザインシステム
- **Apple Human Interface Guidelines準拠** - 洗練されたUIデザイン
- **レスポンシブデザイン** - スマートフォン・PC対応

## プロジェクト構成

```
shift-management-app/
├── app/                      # Next.js App Router
│   ├── api/                # APIエンドポイント
│   │   ├── email/          # メール送信API
│   │   └── email/test/     # メール送信テスト用
│   ├── login/               # ログイン画面
│   ├── dashboard/           # 店長向けダッシュボード
│   ├── shift/create/        # シフト作成・編集
│   ├── my-shift/           # スタッフ向けマイシフト
│   ├── layout.tsx          # ルートレイアウト
│   └── page.tsx            # ホームページ
├── components/             # 再利用可能コンポーネント
│   ├── ui/                # 基本UIコンポーネント
│   │   ├── Button.tsx     # ボタンコンポーネント
│   │   ├── Card.tsx       # カードコンポーネント
│   │   └── Input.tsx      # 入力フィールド
│   └── layout/            # レイアウトコンポーネント
│       ├── Navigation.tsx  # ナビゲーション
│       └── AuthenticatedLayout.tsx
├── lib/                   # ユーティリティとデータ
│   ├── types.ts          # TypeScript型定義
│   ├── mockData.ts       # モックデータ
│   ├── utils.ts          # ユーティリティ関数
│   ├── email.ts          # メール送信機能
│   ├── email-test.ts     # メール送信テスト機能
│   └── api.ts            # API呼び出しヘルパー
└── public/               # 静的ファイル
```

## 実装済み機能（UIのみ）

### 認証システム
- ログイン画面（モック認証）
- ユーザーロール管理（店長・スタッフ）

### 店長向け機能
- ダッシュボード
  - 今日のシフト状況
  - 保留中の希望休申請
  - 代打募集状況
  - クイックアクション
- シフト作成・編集
  - 週単位でのシフト作成
  - 店舗別・時間帯別の必要人数表示
  - 人員過不足の視覚的表示
  - シフトパターンによる色分け

### スタッフ向け機能
- マイシフト表示
  - 週間スケジュール表示
  - 今日のシフト詳細
  - 勤務時間の自動計算

### 共通機能
- レスポンシブナビゲーション
- Apple HIG準拠のデザイン
- モックデータによる動作確認

## 要件定義

### 1. 概要
3店舗（京橋・天満・本町）に勤務する社員・アルバイトのシフト作成および管理をWebアプリケーション上で効率化・汎用化することを目的とする。

### 2. 対象ユーザー
- 店舗責任者（店長）
- アルバイト・社員スタッフ

### 3. 主要機能要件

#### 4.1 シフト作成・管理機能（店長）
- カレンダーをクリックしてシフトを入力・編集
- シフトパターン（通し、ランチ等）をテンプレートとして選択可能
- スタッフ名を選択することで、該当スタッフのスケジュールを自動反映
- 店舗ごとに設定した必要人数と実人数をリアルタイムで比較表示（赤：不足／青：過剰）
- 「確定」操作後、勤務時間・残業時間・人件費概算を自動計算

#### 4.2 スタッフ希望申請・参照機能（スタッフ）
- スマホ／PCブラウザでログイン、操作可能（レスポンシブ）
- 自分のシフトがカレンダーに表示される
- 希望休申請が可能（店長に通知）
- 希望休は店長がワンクリックで承認・却下
- シフトが確定すると、当日0:00に「今日のシフト」が自動プッシュ通知

#### 4.3 欠員対応機能
- 急な欠勤が出た場合、「代打募集」ボタンで全スタッフへ一斉通知
- 出勤可能なスタッフは「参加」ボタンで即応答可

#### 4.4 勤怠ルール管理
- 任意の勤怠ルール（例：週28時間超、7連勤）を設定可能
- 違反時に自動警告表示

#### 4.5 店舗設定機能
- 各店舗ごとに曜日別・時間帯別の必要人数を設定
- 「回せる人（応援に行けるスタッフ）」を指定可能
- 「固定出勤（例：社長は毎週月曜ランチ）」の自動反映設定が可能

#### 4.6 表示・視認性向上
- シフト種別ごとに色分け表示（例：通し＝オレンジ、ランチ＝水色など）

#### 4.7 認証機能およびユーザー属性
- IDおよびパスワードによるログイン認証
- ユーザー属性に応じた操作可能範囲の制御
- 店舗責任者：自店舗のシフト作成・編集・承認、希望休承認、スタッフ管理、代打通知発信
- スタッフ・アルバイト：自分のシフト閲覧、希望休申請、代打応募

### 4. シフト作成操作フロー（店長）
1. ブラウザでURLアクセスし、ログイン
2. 「店舗設定」から各店舗の必要人数や回せる人を設定
3. 「スタッフ管理」でスタッフ情報を登録
4. 「シフトパターン」を登録（最大25件）
5. 週表示または月表示を選び、空きマスをクリックしシフトを登録
6. 全体の人数過不足を色で確認し、必要に応じて調整
7. シフトを「確定」して通知・計算を実行

## 開発開始

```bash
# 依存関係をインストール
npm install

# 開発サーバーを起動
npm run dev
```

ブラウザで [http://localhost:3000](http://localhost:3000) を開いてアプリケーションを確認してください。

### デモ認証情報
- メールアドレス: 任意のメールアドレス
- パスワード: 任意のパスワード

## 今後の実装予定

### バックエンド機能
- Supabase/PostgreSQLでのデータベース設計
- API実装（RESTまたはGraphQL）
- リアルタイム通知機能
- ファイルエクスポート機能

### 追加UI機能
- スタッフ管理画面
- 店舗設定画面
- 希望休申請機能
- 代打募集機能
- モーダル・ダイアログ実装
- フォームバリデーション

### システム機能
- 認証機能の完全実装
- 権限管理システム
- プッシュ通知
- PDF出力機能
- データのインポート・エクスポート

## メール通知機能 ✅

### 実装済みメール機能
ResendのAPIを使用したメール送信機能が実装されています：

- **シフト確定通知**: スタッフへのシフト確定お知らせ
- **希望休申請回答**: 承認・拒否通知
- **代打募集通知**: 緊急時の代打要請メール（一斉送信）
- **今日のシフト通知**: 毎日0:00自動送信 🆕
- **一般通知**: システムからのお知らせ

### 🕐 自動メール送信機能 
- **毎日0:00自動送信**: 確定したシフトがある日に、該当スタッフに今日のシフト通知
- **バッチ処理**: メール送信制限を回避し、複数ユーザーに効率的に配信
- **レート制限対策**: 5件ずつバッチ処理で送信制限を回避

### 環境設定
```bash
# .env.local ファイル
RESEND_API_KEY=your_resend_api_key
NEXT_PUBLIC_APP_NAME=シフト管理システム
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### メール送信テスト
開発環境で以下のURLでメール送信をテストできます：
```
http://localhost:3000/api/email/test
http://localhost:3000/api/test/daily-notifications  # 毎日のシフト通知テスト 🆕
```

### 自動送信のテスト方法
```bash
# 手動で今日のシフト通知をテスト
curl http://localhost:3000/api/test/daily-notifications

# Cron Job直接テスト
curl -X POST http://localhost:3000/api/cron/daily-shift-notifications
```

### 使用方法
```typescript
import { 
  sendShiftConfirmationNotification,
  sendTimeOffResponseNotification,
  sendEmergencyRequestNotification 
} from '@/lib/api';

// シフト確定通知の例
await sendShiftConfirmationNotification(
  'user@example.com',
  'ユーザー名',
  [{ date: '2024-12-30', storeName: '京橋店', ... }]
);
```

---

© 2024 シフト管理システム
